#include <stdio.h>
#include <stdlib.h>
#include "libgaussfit.c"

//Build with gcc -o demo_gaussfit_api demo_gaussfit_api.c -lm
//Run ./demo_gaussfit_api

int main(int argc, char *argv[]){
		//Library initialization
		gaussfitparam myparam;
		initgaussfit(&myparam);
		//Spectrum to fit
		double xdatapoints[500]={-10.0,-9.959919839679358,-9.919839679358718,-9.879759519038076,-9.839679358717435,-9.799599198396793,-9.759519038076153,-9.719438877755511,-9.67935871743487,-9.639278557114228,-9.599198396793588,-9.559118236472946,-9.519038076152304,-9.478957915831664,-9.438877755511022,-9.39879759519038,-9.358717434869739,-9.318637274549099,-9.278557114228457,-9.238476953907815,-9.198396793587175,-9.158316633266534,-9.118236472945892,-9.07815631262525,-9.03807615230461,-8.997995991983968,-8.957915831663327,-8.917835671342685,-8.877755511022045,-8.837675350701403,-8.797595190380761,-8.75751503006012,-8.71743486973948,-8.677354709418838,-8.637274549098196,-8.597194388777556,-8.557114228456914,-8.517034068136272,-8.47695390781563,-8.43687374749499,-8.396793587174349,-8.356713426853707,-8.316633266533067,-8.276553106212425,-8.236472945891784,-8.196392785571142,-8.156312625250502,-8.11623246492986,-8.076152304609218,-8.036072144288577,-7.9959919839679365,-7.955911823647295,-7.915831663326653,-7.875751503006012,-7.835671342685371,-7.7955911823647295,-7.755511022044088,-7.715430861723447,-7.675350701402806,-7.635270541082164,-7.595190380761523,-7.555110220440882,-7.515030060120241,-7.474949899799599,-7.434869739478958,-7.394789579158317,-7.354709418837675,-7.314629258517034,-7.274549098196393,-7.234468937875752,-7.19438877755511,-7.154308617234469,-7.114228456913828,-7.074148296593187,-7.034068136272545,-6.993987975951904,-6.953907815631263,-6.913827655310621,-6.8737474949899795,-6.833667334669339,-6.793587174348698,-6.753507014028056,-6.713426853707415,-6.673346693386774,-6.6332665330661325,-6.593186372745491,-6.55310621242485,-6.513026052104209,-6.472945891783567,-6.432865731462925,-6.3927855711422845,-6.352705410821644,-6.312625250501002,-6.272545090180361,-6.23246492985972,-6.192384769539078,-6.152304609218437,-6.112224448897796,-6.072144288577155,-6.032064128256513,-5.991983967935872,-5.95190380761523,-5.9118236472945895,-5.871743486973948,-5.831663326653307,-5.791583166332665,-5.751503006012024,-5.711422845691383,-5.671342685370742,-5.631262525050101,-5.591182364729459,-5.551102204408818,-5.511022044088176,-5.470941883767535,-5.430861723446894,-5.390781563126253,-5.350701402805611,-5.31062124248497,-5.270541082164329,-5.2304609218436875,-5.190380761523047,-5.150300601202405,-5.110220440881764,-5.070140280561122,-5.030060120240481,-4.98997995991984,-4.949899799599199,-4.909819639278557,-4.869739478957916,-4.829659318637275,-4.789579158316633,-4.7494989979959925,-4.709418837675351,-4.66933867735471,-4.629258517034068,-4.589178356713427,-4.5490981963927855,-4.509018036072145,-4.468937875751503,-4.428857715430862,-4.388777555110221,-4.348697394789579,-4.308617234468938,-4.268537074148297,-4.228456913827656,-4.188376753507014,-4.148296593186373,-4.108216432865731,-4.0681362725450905,-4.028056112224449,-3.987975951903808,-3.947895791583167,-3.907815631262525,-3.8677354709418843,-3.8276553106212425,-3.7875751503006017,-3.74749498997996,-3.707414829659319,-3.6673346693386772,-3.6272545090180364,-3.5871743486973955,-3.5470941883767537,-3.507014028056113,-3.466933867735471,-3.42685370741483,-3.3867735470941884,-3.3466933867735476,-3.306613226452906,-3.266533066132265,-3.226452905811623,-3.1863727454909823,-3.1462925851703414,-3.1062124248496996,-3.0661322645290587,-3.026052104208417,-2.985971943887776,-2.9458917835671343,-2.9058116232464934,-2.8657314629258517,-2.825651302605211,-2.785571142284569,-2.745490981963928,-2.7054108216432873,-2.6653306613226455,-2.6252505010020046,-2.585170340681363,-2.545090180360722,-2.50501002004008,-2.4649298597194393,-2.4248496993987976,-2.3847695390781567,-2.344689378757515,-2.304609218436874,-2.264529058116233,-2.2244488977955914,-2.1843687374749505,-2.1442885771543088,-2.104208416833668,-2.064128256513026,-2.0240480961923852,-1.9839679358717444,-1.9438877755511026,-1.9038076152304608,-1.8637274549098208,-1.823647294589179,-1.7835671342685373,-1.7434869739478955,-1.7034068136272555,-1.6633266533066138,-1.623246492985972,-1.5831663326653302,-1.5430861723446903,-1.5030060120240485,-1.4629258517034067,-1.4228456913827667,-1.382765531062125,-1.3426853707414832,-1.3026052104208414,-1.2625250501002014,-1.2224448897795597,-1.182364729458918,-1.1422845691382761,-1.1022044088176361,-1.0621242484969944,-1.0220440881763526,-0.9819639278557126,-0.9418837675350709,-0.9018036072144291,-0.8617234468937873,-0.8216432865731473,-0.7815631262525056,-0.7414829659318638,-0.701402805611222,-0.661322645290582,-0.6212424849699403,-0.5811623246492985,-0.5410821643286585,-0.5010020040080168,-0.460921843687375,-0.4208416833667332,-0.38076152304609323,-0.34068136272545146,-0.3006012024048097,-0.26052104208416793,-0.22044088176352794,-0.18036072144288617,-0.1402805611222444,-0.10020040080160442,-0.06012024048096265,-0.020040080160320883,0.020040080160320883,0.060120240480960874,0.10020040080160264,0.1402805611222444,0.18036072144288617,0.22044088176352616,0.26052104208416793,0.3006012024048097,0.3406813627254497,0.38076152304609145,0.4208416833667332,0.460921843687375,0.501002004008015,0.5410821643286567,0.5811623246492985,0.6212424849699403,0.6613226452905803,0.701402805611222,0.7414829659318638,0.7815631262525038,0.8216432865731456,0.8617234468937873,0.9018036072144291,0.9418837675350691,0.9819639278557108,1.0220440881763526,1.0621242484969944,1.1022044088176344,1.1422845691382761,1.182364729458918,1.222444889779558,1.2625250501001997,1.3026052104208414,1.3426853707414832,1.3827655310621232,1.422845691382765,1.4629258517034067,1.5030060120240485,1.5430861723446885,1.5831663326653302,1.623246492985972,1.663326653306612,1.7034068136272538,1.7434869739478955,1.7835671342685373,1.8236472945891773,1.863727454909819,1.9038076152304608,1.9438877755511026,1.9839679358717426,2.0240480961923843,2.064128256513026,2.104208416833666,2.144288577154308,2.1843687374749496,2.2244488977955914,2.2645290581162314,2.304609218436873,2.344689378757515,2.3847695390781567,2.4248496993987967,2.4649298597194385,2.50501002004008,2.54509018036072,2.585170340681362,2.6252505010020037,2.6653306613226455,2.7054108216432855,2.7454909819639273,2.785571142284569,2.825651302605209,2.865731462925851,2.9058116232464926,2.9458917835671343,2.9859719438877743,3.026052104208416,3.066132264529058,3.1062124248496996,3.1462925851703396,3.1863727454909814,3.226452905811623,3.266533066132263,3.306613226452905,3.3466933867735467,3.3867735470941884,3.4268537074148284,3.46693386773547,3.507014028056112,3.5470941883767537,3.5871743486973937,3.6272545090180355,3.6673346693386772,3.7074148296593172,3.747494989979959,3.7875751503006008,3.8276553106212425,3.8677354709418825,3.9078156312625243,3.947895791583166,3.987975951903808,4.028056112224448,4.06813627254509,4.108216432865731,4.148296593186371,4.188376753507013,4.228456913827655,4.268537074148297,4.308617234468937,4.348697394789578,4.38877755511022,4.428857715430862,4.468937875751502,4.509018036072144,4.5490981963927855,4.589178356713425,4.629258517034067,4.669338677354709,4.709418837675351,4.749498997995991,4.7895791583166325,4.829659318637274,4.869739478957916,4.909819639278556,4.949899799599198,4.98997995991984,5.0300601202404795,5.070140280561121,5.110220440881763,5.150300601202405,5.190380761523045,5.230460921843687,5.270541082164328,5.31062124248497,5.35070140280561,5.390781563126252,5.430861723446894,5.470941883767534,5.511022044088175,5.551102204408817,5.591182364729459,5.631262525050099,5.671342685370741,5.7114228456913825,5.751503006012024,5.791583166332664,5.831663326653306,5.871743486973948,5.911823647294588,5.9519038076152295,5.991983967935871,6.032064128256511,6.072144288577153,6.112224448897795,6.152304609218437,6.192384769539078,6.23246492985972,6.272545090180358,6.312625250501,6.352705410821642,6.392785571142284,6.432865731462925,6.472945891783567,6.513026052104209,6.553106212424851,6.593186372745489,6.633266533066131,6.673346693386772,6.713426853707414,6.753507014028056,6.793587174348698,6.8336673346693395,6.873747494989978,6.9138276553106195,6.953907815631261,6.993987975951903,7.034068136272545,7.074148296593187,7.114228456913828,7.1543086172344665,7.194388777555108,7.23446893787575,7.274549098196392,7.314629258517034,7.354709418837675,7.394789579158317,7.434869739478959,7.474949899799597,7.515030060120239,7.555110220440881,7.595190380761522,7.635270541082164,7.675350701402806,7.715430861723448,7.755511022044086,7.795591182364728,7.8356713426853695,7.875751503006011,7.915831663326653,7.955911823647295,7.9959919839679365,8.036072144288575,8.076152304609217,8.116232464929858,8.1563126252505,8.196392785571142,8.236472945891784,8.276553106212425,8.316633266533067,8.356713426853705,8.396793587174347,8.436873747494989,8.47695390781563,8.517034068136272,8.557114228456914,8.597194388777556,8.637274549098194,8.677354709418836,8.717434869739478,8.75751503006012,8.797595190380761,8.837675350701403,8.877755511022045,8.917835671342683,8.957915831663325,8.997995991983966,9.038076152304608,9.07815631262525,9.118236472945892,9.158316633266534,9.198396793587175,9.238476953907814,9.278557114228455,9.318637274549097,9.358717434869739,9.39879759519038,9.438877755511022,9.478957915831664,9.519038076152302,9.559118236472944,9.599198396793586,9.639278557114228,9.67935871743487,9.719438877755511,9.759519038076153,9.799599198396791,9.839679358717433,9.879759519038075,9.919839679358716,9.959919839679358,10.0};
		double ydatapoints[500]={1.4278778450203806,2.310230078609493,0.0402612072812652,0.4228180614526669,1.7062690032074959,-0.5081167657466374,1.4307120242517424,-0.48232887207702535,0.5119701875307839,0.7963739184549372,-0.3612273975391394,0.18119491979539765,1.7919372637308149,1.8568006006160078,0.1611965999849529,0.5547976175519628,0.011971459170386334,0.9849260368723219,-0.47329148617557526,0.1647532959713403,1.049384740743461,0.550922906749516,1.73264673435769,-0.4379907266502966,-1.37594973953839,0.7609119779962905,2.6136415486064273,0.025469196245716752,1.5491273913482702,0.14846379841814683,1.720316499697831,1.8331521748495487,1.1613718374287174,-0.9836924007912133,1.5758043630552034,1.020422859623093,1.2004053332680957,2.341976273148199,-0.6241814994289152,-0.5552052621107635,0.45863570219762806,0.1864718546339873,0.13161272140275548,2.392891780378833,2.031436110603801,1.4003866878427447,1.5658436782359084,-0.7805113965381765,1.6850434834944987,-0.2540153217300709,1.2073889799359159,1.213196386581343,-1.2393128178813997,-0.018451879465386734,2.340500718411776,0.6068726630816887,3.1538901938372113,1.2208581385644794,1.5898972099989095,2.3876486645716364,0.8047734906509325,1.7773661530725888,2.9526223330208294,-0.27830601057758875,2.315936988782009,0.6721888073021312,2.3508379326152067,1.4516712740705477,1.9813708543686357,2.7290644924779537,2.7329250846639708,1.977085900427252,4.012141536340879,2.1243073743960394,2.1645055649343936,3.396742809645417,2.4582689580168258,3.2158424396667957,2.526116598487054,2.933396196341023,3.3912505972316094,3.214285085403605,3.823145521006704,4.743422044665858,3.781312591184545,5.660988082825744,5.6099316726218245,4.352264664509383,4.847377148613267,5.273048028718958,4.3959690398980324,4.530145294244982,5.604443402178996,5.048636702398188,6.5337071390259975,6.6130159306578316,5.116450899416417,6.778374561587835,6.765502824081354,7.859279192352596,8.16438693313186,9.199983563019686,7.417818682986801,8.659532872023151,8.449733187061641,7.3277080262404946,9.2753492424577,9.7365811761073,10.312915542927664,9.975812550835752,8.346477025359611,9.997506392301757,10.82660072517691,10.646371352551206,9.681738181327493,8.149039172715918,11.918948618939199,10.37290791845657,12.116008275957542,11.116495164383274,11.958810519759954,11.802514642584546,10.341513335348637,11.41206618594416,11.220199680258649,13.126904216620803,9.68357026463359,9.208787948685767,13.567419049356545,10.865359259055783,11.933198100774609,12.546587248165231,11.248961831209817,12.037420230302542,12.491247465662298,12.750082652163131,12.67803139619572,11.21189533967273,11.264001878271491,11.291145697671249,14.082267472775353,11.60761103117449,11.306347034333154,11.131025632371202,11.05765292163427,10.838918922414178,10.519071612431095,10.19150569347658,11.411646601916212,9.84497269611817,9.742918476154145,10.402343471341126,9.191855881170282,10.463191338054289,8.903451503240994,10.035308503266762,9.317990927278071,7.760743654820448,10.199154453368251,9.37052783329269,9.485394804321253,8.491769015428808,7.710441941225615,10.065210402789916,10.142079509582793,8.248235993894372,8.338315883577964,8.7726147095513,6.940804449171335,6.762182526956786,7.828393103413894,10.528537420642113,9.125040988073513,7.637562007525489,7.563200483787449,6.846763781463945,9.067923448055598,8.534357778002667,8.154225077734415,8.56216186811427,8.441086237589609,9.272390796997188,8.337892327676995,11.945348537706968,9.353948331736335,10.058829313891065,8.739688461987265,8.135816022554675,8.007427085459776,8.231108224036713,9.25399285269618,9.067119680489824,10.178713946733843,8.747518611635478,10.990613488973064,10.256416695725207,11.481757838892037,8.338705206214545,8.823433442655467,10.058350434843868,9.520145219344322,8.872111677834345,10.459924788822216,10.207617401604498,10.871441090569334,9.540042259363979,10.475192474818966,10.328405519895984,9.597851986290232,11.926226135113755,11.196959764881633,11.97149658415732,12.151496024364876,11.133870043310264,9.83326729273164,11.06166465216274,10.126725030059713,10.918128265634653,11.016952442247469,10.073643455389968,11.968408392741027,10.991771891561193,12.007356820756387,12.369934239225648,10.447574639899237,13.437456050351607,13.966736330300957,11.644224392765414,12.111274178132367,13.40288041250145,13.255621534188716,11.81715025573112,14.089602948655308,14.595925034675684,13.156036112805397,11.526901066789758,14.651527155165065,13.01962368201673,13.809610636703011,12.878748042951273,12.81550460646562,15.005174763969206,15.204448858548528,15.35748226319302,14.098356237407316,15.481978316884863,14.092097356868136,14.612544540751578,15.641073781470885,14.161796222655097,13.98821490389811,13.271413705328944,13.566365335978759,14.01074915572571,17.650477490105338,15.71687801850219,15.853035254589084,16.56527813684789,13.823578080761013,15.609878845689183,14.036892062225185,15.931970128754998,16.886993798067337,14.590716525697072,16.718039916586203,14.155931418108318,15.7994159019586,14.71177520727975,15.989505976596067,17.233082236442193,17.64493459185553,17.091923910333257,16.904819541245924,15.780046069828876,15.944682914164817,17.01450601693858,17.167675470620782,15.785426588171953,16.848884708498403,16.481955850083033,15.914008274133208,16.62176850579053,18.005772161572313,16.61050342719155,17.75107597495358,18.5398586868276,18.312432604611313,20.320965941604864,18.48229578628684,17.790931481741637,16.702564718946665,19.416380931975674,16.43090683108371,16.957135958803455,17.544722861467086,19.74879427115194,18.33024000824152,19.12245628016298,19.17754897462551,18.986672135050767,20.034080605083243,18.547359337471118,17.918986060243956,19.402305888662095,19.07986501221355,17.63822842972789,21.064619065945266,18.356892100109928,18.940846937313648,19.228003486856558,20.804890633411844,19.405711447229244,18.371697860682886,18.985639663390238,19.859046106715507,19.34093056380109,18.5360066443196,19.052557974937258,20.312455405981726,19.98445700631891,20.053311044544863,19.512807563409,19.724572858321665,20.22512597922002,19.229220018346446,20.25366081242597,19.870628482533494,20.618074912072135,18.69036850797129,20.186807227643452,21.204431852445207,19.803083021915352,20.17668446845117,19.496799598801676,19.209407854186626,20.34770398769484,21.12400593050688,19.28669479246342,20.020766913672883,18.979266081954922,21.196152259577765,19.499828542606284,21.095918279000607,20.592079739776256,20.428999372629256,20.715093689645105,20.94970302004477,19.00917593622067,20.328471921880592,19.98672281874484,18.751950576099976,20.02499388140018,20.28587126667048,18.386640008327003,20.13719805744994,19.701454645567768,20.38580698307968,18.350751328351453,18.860151748311292,19.052296977874313,19.703128689157015,20.223029448403917,20.822443795683764,17.924828960239523,20.492895626499376,20.033421733256638,20.835941316899106,18.377511087729253,19.816414486104307,19.20076195497113,18.761410116406978,19.0809847617179,18.63293924231487,20.468025098004812,20.27504244866615,20.684106572033222,20.469217139910413,18.564345343162213,17.736401441435575,17.600035681518136,19.00304795613731,20.809200202273324,18.687168749258092,21.302376317581942,19.12800555797063,17.851538931157286,20.423684740841253,16.97097042035207,17.75030434935368,18.61432394808457,18.591254265191445,18.454582674829222,18.718152309333508,17.833613294460033,18.004435195471967,17.922921272914838,18.19122464906058,20.272220875749465,15.943374844859713,17.84737984763501,16.74644039207417,17.183657577864754,18.06467686207434,17.472620477942307,17.45874515546639,17.497185765247576,17.70140643550605,16.76786165417599,17.86528271890018,18.55922155017522,16.019615245705285,18.825324175850223,17.384827062640046,18.441408975598193,19.17457226163048,18.166110936586556,18.548032490774983,17.895560065430768,16.774712927428993,16.29470122638885,16.89937587667029,15.656818093623807,16.138367370045447,16.391413755305887,17.051195846491265,16.36878242104183,15.570361868479226,15.783260062579942,16.291583086105163,17.35117657306806,16.286354866878906,16.86871390536036,16.525431073096872,15.812665723069566,14.603192024803363,17.019486452342612,15.456493895320875,13.972156427957074,15.185133735521292,17.33316490729424,16.317871467966835,14.510998243368359,14.785741931977793,15.792133252308686,15.206348747758984,14.388279055445633,15.39384819562722,12.30721889144318,14.856626356102645,14.132866947565292,15.434305902769545,14.520450285626916,13.65457242767352,15.116362107063015,13.148563024803991,13.57157486968147,13.906452266032293,12.816800733366174,11.462589913273394,13.55447868557625,13.159526148831187,12.381857489343641,13.436209018605762,15.495104303986087,12.450341579891273,14.56973979144755,13.898778452898288,14.461778218361838,11.926567682451877,14.308525031587896,14.021759672921801,13.726469519776405,12.174231062989913,12.222709986219302,11.78986323742579,11.534810944654412,12.350419461685544,9.780872345169438,11.149937233718395,10.950915057420813,11.396511384802396,11.914607136445433,11.474272940152543,13.001776878997306,11.734321821666738,10.80957914073026,10.762995019031004,12.044344921383871,9.132702834067254,11.553483576239561,9.772583784222817,11.062286873192091,10.676496974457526,9.695582471084542,11.707788250654284,8.798886412380028,9.752423798294855,9.835662417779417,10.11890815364757,10.79560162146467};
		myparam.x=xdatapoints;
		myparam.y=ydatapoints;
		myparam.Npoints=500;
		boxcar(&myparam,10);
		removebaseline(&myparam,0);
		automaticguess(&myparam,0.9,95,0.95,1.1,0);//First number as 0.9 instead of 0.2 on automaticguess makes it miss the smaller peak, lets add a initial guess for the missed peak manually.
		addgaussian(&myparam,11,1,-4);
		//We could also add Lorentzians initial guess.
		//addlorentzian(&myparam,19,3,3);
		//Print initial guess.
		printf("\x1b[36mGaussians initial guess:\x1b[0m\n\x1b[32m");
		int ijj=0;
		while(ijj<getNumberFittedGaussians(&myparam)){
			printf("(A,sigma,mu)=(%f,%f,%f)\n",getInitialGuess(&myparam,ijj)->A,getInitialGuess(&myparam,ijj)->sigma,getInitialGuess(&myparam,ijj)->mu);
			ijj=ijj+1;
		}
		//Fit the spectrum based on the guesses addded.
		fitgaussians(&myparam);
		//Lets print the result.
		printf("\x1b[0m\n     ┌───────────────────────────────────────────────────────────────────┐\n     │                     ...:::Final Results:::...                     │\n     ├──────────────┬─────────────────┬────────────────┬─────────────────┤\n");
		int i=0;
		for (i = 0;i<getNumberFittedGaussians(&myparam)-1;i++) {
			if(getFitResult(&myparam,i)->type==0){
				printf("     │Gaussian   %03i│ A=%+013.5f │σ=%+013.5f │μ=%+013.5f  │\n     ├──────────────┼─────────────────┼────────────────┼─────────────────┤\n",i,getFitResult(&myparam,i)->A,getFitResult(&myparam,i)->sigma,getFitResult(&myparam,i)->mu);
			}else{
				printf("     │Lorentzian %03i│ A=%+013.5f │σ=%+013.5f │μ=%+013.5f  │\n     ├──────────────┼─────────────────┼────────────────┼─────────────────┤\n",i,getFitResult(&myparam,i)->A,getFitResult(&myparam,i)->sigma,getFitResult(&myparam,i)->mu);
			}
		}
		if(getFitResult(&myparam,i)->type==0){
			printf("     │Gaussian   %03i│ A=%+013.5f │σ=%+013.5f │μ=%+013.5f  │\n",i,getFitResult(&myparam,i)->A,getFitResult(&myparam,i)->sigma,getFitResult(&myparam,i)->mu);
		}else{
			printf("     │Lorentzian %03i│ A=%+013.5f │σ=%+013.5f │μ=%+013.5f  │\n",i,getFitResult(&myparam,i)->A,getFitResult(&myparam,i)->sigma,getFitResult(&myparam,i)->mu);
		}
		printf("     └──────────────┴─────────────────┴────────────────┴─────────────────┘\n\n");
		//Show fit result on gnuplot window.
		showfitresult_gnuplot(&myparam);
		return 0;
}
